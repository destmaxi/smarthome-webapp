version: "3"
services:
  test-smarthome-db:
    image: "kv-storage-system:latest"
    ports:
      - "5000:5984"
    networks:
      - test-backend
    logging:
      driver: none

  user:
    build: ./user
    ports:
      - "5080:5080"
    volumes:
      - /home/$USER/Documents/webapp/test/user/test:/usr/src/user-service/test
      - /home/$USER/Documents/webapp/test/user/jsons:/usr/src/user-service/test-jsons
      - /home/$USER/Documents/webapp/test/boot-in-order.sh:/usr/src/user-service/boot-in-order.sh
      - /home/$USER/Documents/webapp/src/backend/user:/usr/src/user-service
      - /home/$USER/Documents/webapp/src/backend/gulpfile.js:/usr/src/user-service/gulpfile.js
      - /home/$USER/Documents/webapp/src/backend/daemon.js:/usr/src/user-service/src/daemon.js
      - /usr/src/user-service/node_modules
    environment:
      - NODE_ENV=development
    networks:
      - test-backend
    depends_on:
      - test-smarthome-db

  room:
    build: ./room
    ports:
      - "5081:5081"
    volumes:
      - /home/$USER/Documents/webapp/test/room/test:/usr/src/room-service/test
      - /home/$USER/Documents/webapp/test/boot-in-order.sh:/usr/src/room-service/boot-in-order.sh
      - /home/$USER/Documents/webapp/src/backend/room:/usr/src/room-service
      - /home/$USER/Documents/webapp/test/room/jsons:/usr/src/room-service/test-jsons
      - /home/$USER/Documents/webapp/src/backend/gulpfile.js:/usr/src/room-service/gulpfile.js
      - /home/$USER/Documents/webapp/src/backend/daemon.js:/usr/src/room-service/src/daemon.js
      - /usr/src/room-service/node_modules
    environment:
      - NODE_ENV=development
    networks:
      - test-backend
    depends_on:
      - test-smarthome-db
      - auth

  auth:
    build: ./user
    ports:
      - "5090:5090"
    volumes:
      - /home/$USER/Documents/webapp/src/backend/user:/usr/src/user-service
      - /home/$USER/Documents/webapp/test/boot-in-order.sh:/usr/src/user-service/boot-in-order.sh
      - /home/$USER/Documents/webapp/test/user/jsons:/usr/src/user-service/test-jsons
      - /home/$USER/Documents/webapp/src/backend/gulpfile.js:/usr/src/user-service/gulpfile.js
      - /home/$USER/Documents/webapp/src/backend/daemon.js:/usr/src/user-service/src/daemon.js
      - /usr/src/user-service/node_modules
    environment:
      - NODE_ENV=development
      - REALUSER=true
      - SERVICE_PORT=5090
      - SERVICE_NAME=sim-user
    networks:
      - test-backend
    restart: on-failure
    depends_on:
      - test-smarthome-db

networks:
  test-backend:
    driver: overlay
